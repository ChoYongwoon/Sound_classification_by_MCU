#include <EloquentTinyML.h>

#include "sound_model.h"

#define N_INPUTS 128
#define N_OUTPUTS 10
#define TENSOR_ARENA_SIZE 16*1024

Eloquent::TinyML::TfLite<N_INPUTS, N_OUTPUTS, TENSOR_ARENA_SIZE> nn;

float X_test[5][128] = {{5.98918634e-03, 5.07194905e-03, 9.75216705e-03, 1.49311392e-02,
        1.14315622e-02, 7.35353815e-03, 8.29933769e-03, 8.94530547e-03,
        5.62749480e-03, 9.20147600e-03, 1.50492153e-02, 2.01415232e-02,
        2.09410277e-03, 2.48305177e-02, 2.53226998e-02, 1.56612278e-02,
        2.19483871e-02, 2.72438677e-02, 2.27007903e-02, 3.36823848e-02,
        4.88250327e-03, 2.93919032e-02, 1.58951063e-02, 8.04900603e-03,
        8.49649982e-03, 3.57985076e-03, 3.97182521e-02, 4.21649568e-02,
        1.79770828e-02, 3.25569925e-02, 4.67040973e-02, 1.53467684e-02,
        2.65167455e-02, 1.71338239e-02, 1.77068671e-02, 3.55579943e-02,
        6.84376544e-02, 7.36680491e-02, 1.38875175e-02, 7.02297576e-02,
        2.39036239e-02, 1.66091941e-02, 9.30977738e-02, 1.50419042e-02,
        8.18315245e-02, 1.65011722e-01, 5.17802284e-01, 1.85159958e-01,
        1.26602322e-01, 2.64882944e-02, 9.69910371e-02, 7.19812789e-02,
        5.42329225e-02, 3.57623537e-02, 1.28666953e-01, 1.33165869e-01,
        3.17254084e-02, 1.01090763e-01, 2.86558395e-02, 6.78978334e-02,
        1.04688635e-01, 8.69266038e-02, 1.11076038e-01, 1.31094210e-01,
        1.54504720e-01, 7.02415082e-02, 1.58839223e-01, 7.03613009e-02,
        5.33864725e-02, 1.30644820e-02, 6.42618410e-02, 8.77283644e-02,
        1.39766140e-01, 2.06164723e-01, 9.74083334e-02, 7.95971106e-02,
        4.61492478e-02, 1.65113770e-01, 1.45497515e-01, 1.08234500e-01,
        8.22279394e-02, 1.74873064e-01, 1.03598950e-01, 1.10644766e-01,
        5.02724779e-02, 1.05289248e-01, 2.74837306e-02, 9.49811413e-02,
        5.51592628e-02, 2.37858534e-01, 5.98190058e-01, 5.05351954e-01,
        6.85696543e-02, 7.29411335e-02, 1.14070182e-01, 1.28348499e-01,
        1.11780769e-01, 1.50736644e-01, 1.45054619e-01, 9.51221976e-02,
        1.90123880e-01, 8.30519779e-02, 1.26218249e-01, 3.18868923e-02,
        3.59014676e-02, 2.30985761e-02, 1.91027425e-02, 1.80090839e-02,
        1.65265485e-02, 1.48439784e-02, 1.41198032e-02, 1.32109956e-02,
        1.28478164e-02, 1.21204003e-02, 1.15327538e-02, 1.10275564e-02,
        1.06435364e-02, 1.01772511e-02, 9.92880559e-03, 9.59797201e-03,
        9.40925082e-03, 9.23140012e-03, 8.80451053e-03, 8.91716805e-03,
        8.78851785e-03, 8.50493715e-03, 8.32941003e-03, 8.52214296e-03},
       {1.62319687e-02, 1.54447511e-02, 1.65019135e-02, 2.98084520e-02,
        3.60118958e-02, 3.26244435e-02, 6.17641357e-02, 9.57195250e-02,
        7.64669594e-02, 6.93118530e-02, 8.47429887e-02, 3.47964896e-02,
        6.88001141e-02, 1.38835852e-01, 1.02331716e-01, 1.11905324e-01,
        1.69977774e-01, 4.75736346e-02, 6.76851905e-02, 3.20598282e-02,
        2.56206566e-01, 5.00560876e-02, 2.04315891e-01, 1.46701021e-01,
        9.37949279e-02, 1.64765737e-01, 5.20705487e-01, 1.06471599e+00,
        2.06505654e-01, 5.50157681e-01, 4.01260496e-01, 5.41536235e-01,
        1.88071978e-01, 1.89478570e-01, 6.10350940e-01, 2.54191180e-01,
        3.79296711e-01, 8.51182373e-01, 4.94645336e-01, 1.99123416e-01,
        5.39364858e-01, 2.40749488e-01, 3.96720489e-01, 3.51802566e-01,
        2.00837937e-01, 3.90281735e-01, 5.50152108e-01, 3.44641783e-01,
        5.27680119e-01, 2.47209928e-01, 1.54990464e-01, 3.54388419e-01,
        1.52862455e-01, 8.80453579e-01, 1.25447706e-01, 2.27153616e-01,
        6.04367067e-02, 4.57551229e-01, 1.16887328e+00, 5.83782052e-01,
        1.03913331e+00, 4.61678245e-01, 4.30401333e-01, 1.46615159e-01,
        5.12929198e-01, 3.08985174e-01, 3.96638857e-01, 1.93905751e-01,
        1.65048699e-01, 7.91657087e-01, 1.21911674e+00, 4.20541753e-01,
        4.70334781e-01, 6.28093820e-01, 9.84591320e-01, 2.73270882e-01,
        7.44481026e-01, 8.97038134e-01, 5.14016936e-01, 1.11338212e+00,
        1.57738250e+00, 3.75939364e+00, 6.21259385e+00, 2.07133660e+00,
        8.57462051e-01, 7.09689319e-01, 5.73341458e-01, 6.27164750e-01,
        4.73416421e-01, 2.42748931e-01, 3.01816770e-01, 6.40794837e-01,
        8.25222058e-01, 1.03355937e+00, 3.50932489e-01, 1.62874913e-01,
        3.08769764e-01, 1.80085557e-01, 2.23047412e-01, 1.93769444e-01,
        2.11262993e-01, 2.98032935e-01, 1.12431686e-01, 1.07663277e-01,
        1.40691771e-01, 7.76149890e-02, 7.09582607e-02, 6.57285156e-02,
        6.22871747e-02, 6.02328708e-02, 5.76894739e-02, 5.69095371e-02,
        5.42824465e-02, 5.24511323e-02, 5.07120731e-02, 5.10517899e-02,
        4.46931651e-02, 4.48816158e-02, 4.53639708e-02, 4.40402439e-02,
        4.36868180e-02, 4.31537651e-02, 4.31749343e-02, 4.12965938e-02,
        4.05932218e-02, 4.05129880e-02, 4.05074760e-02, 4.10836070e-02},
       {3.34636402e-02, 5.71577829e-02, 6.47339014e-02, 5.97873260e-02,
        8.09324768e-02, 7.39048017e-02, 6.86105045e-02, 2.38127838e-01,
        5.04663831e-02, 5.10579800e-02, 7.84297111e-02, 1.79904144e-02,
        3.95189687e-02, 1.41057422e-01, 1.16906205e-01, 7.56897703e-02,
        1.24483981e-01, 1.28351154e-01, 1.92530358e-01, 2.12685995e-01,
        4.92442058e-02, 1.95723071e-01, 1.65289085e-01, 2.84917104e-01,
        3.88860174e-02, 9.95694363e-02, 1.66297043e-01, 6.77371532e-02,
        8.24767582e-02, 1.71896943e-01, 1.08738984e-01, 1.77311626e-01,
        3.04085548e-01, 2.52891864e-01, 5.68193898e-02, 3.47431599e-01,
        1.71875470e-01, 2.28762929e-01, 7.05648193e-02, 1.95741072e-01,
        1.92844406e-01, 6.82261087e-01, 8.50596473e-01, 6.46291750e-01,
        1.06836274e+00, 7.54425289e-01, 4.19627403e-01, 4.87076610e-01,
        3.74110740e-01, 1.16881563e+00, 7.88256382e-01, 2.78486794e-01,
        5.82360349e-01, 2.59903978e-01, 3.13517267e-01, 5.43279344e-01,
        5.11839129e-02, 3.35390911e-01, 7.32546237e-01, 1.28548592e-01,
        8.04412420e-01, 6.53919560e-01, 6.63197241e-01, 2.78321635e-01,
        8.37731858e-01, 8.40099379e-01, 1.45578633e+00, 9.82877251e-01,
        6.03616132e-01, 9.80368464e-01, 9.03999446e-01, 1.76816083e+00,
        1.59297694e+00, 1.58806778e+00, 4.60472707e-01, 1.09056114e+00,
        4.21228669e-01, 6.68467025e-01, 5.81420139e-01, 1.24021644e+00,
        1.95188915e-01, 9.60154881e-01, 7.54812700e-01, 3.39981236e-01,
        4.01980301e-01, 7.18716234e-01, 4.38631194e-01, 1.30617353e-01,
        1.19293385e+00, 2.54690229e-01, 4.96101373e-01, 4.44596629e-01,
        3.40055750e-01, 2.70230939e-01, 6.26161345e-02, 6.33385142e-01,
        3.99280826e-01, 1.57470931e-01, 3.72314447e-01, 9.29053835e-01,
        3.12457219e-01, 2.57469784e-01, 1.69275906e-01, 1.21238118e-01,
        6.67164947e-02, 6.74670584e-02, 2.62311893e-02, 2.78517026e-02,
        2.67604196e-02, 2.49393942e-02, 2.46707658e-02, 2.46799120e-02,
        2.62483539e-02, 2.33843763e-02, 2.31393541e-02, 2.37221917e-02,
        2.43019152e-02, 2.53672339e-02, 2.36496865e-02, 2.28241276e-02,
        2.38038032e-02, 2.43851828e-02, 2.37538546e-02, 2.30712012e-02,
        2.24826725e-02, 2.28638453e-02, 2.42517499e-02, 2.33472585e-02},
       {3.26929376e-02, 1.24499363e-02, 1.40348001e-02, 1.28669298e-02,
        8.41732401e-03, 8.13699971e-03, 6.12902566e-02, 3.45794824e-02,
        9.98255360e-03, 5.94869260e-02, 2.69628079e-02, 1.35530563e-01,
        5.43585541e-03, 1.04828300e-01, 8.32802850e-02, 1.64693032e-01,
        1.35095587e-01, 1.50898293e-01, 2.20859041e-01, 1.29254279e-01,
        1.08188733e-01, 3.54837882e-01, 1.85475585e-01, 1.19536172e-01,
        1.95720873e-01, 1.60589172e-01, 4.16282092e-01, 5.77894730e-01,
        4.72880463e-01, 1.66880321e+00, 3.45686643e-01, 3.83655095e-01,
        1.25155914e-01, 4.86820542e-01, 2.85358706e-01, 1.63583624e-01,
        2.54785968e-01, 1.34527155e-01, 8.63322514e-02, 3.55772088e-01,
        4.44572024e-01, 2.15084806e-01, 2.23418292e-01, 7.44679968e-01,
        7.39347412e-02, 5.01823787e-01, 1.23530859e-01, 9.76194315e-02,
        2.51672399e-01, 1.26324599e-01, 2.39395367e-01, 3.90673339e-02,
        2.10426317e-01, 3.16227549e-01, 4.86226148e-01, 2.79092556e-01,
        5.46930552e-01, 1.96328103e-01, 9.11763019e-01, 1.24685770e+00,
        1.93361494e-01, 5.12146749e-01, 1.58528455e-01, 1.13712934e+00,
        3.41684712e+00, 2.49662433e+00, 2.77464041e-01, 2.77278232e-01,
        9.31896657e-02, 2.31973442e-01, 3.52276452e-01, 4.74444186e-01,
        2.11061653e-01, 1.24781253e-01, 2.06674070e-01, 1.08205919e-01,
        2.86514592e-01, 1.44988347e-01, 1.75451604e-01, 4.47932831e-02,
        2.37466248e-01, 6.11753723e-02, 2.60678185e-01, 8.37077396e-01,
        7.81480193e-01, 6.22366560e-01, 2.42660422e+00, 5.28067893e-01,
        2.84092983e+00, 2.26777429e+00, 4.30727989e-01, 3.20160311e-01,
        3.32637198e-01, 2.78230744e-01, 1.67512932e-01, 2.59221508e-01,
        2.24316408e-01, 3.16078444e-01, 6.31753247e-01, 2.23981243e-01,
        9.65223292e-02, 1.66658703e-01, 1.57462362e-01, 1.53730743e-01,
        1.85272082e-01, 9.69652266e-02, 9.32475797e-02, 7.89512725e-02,
        6.82636934e-02, 6.62756993e-02, 6.21941798e-02, 5.97389195e-02,
        5.60124201e-02, 5.37071797e-02, 5.16101431e-02, 5.05140737e-02,
        4.83541639e-02, 4.70287936e-02, 4.62757237e-02, 4.48547111e-02,
        4.65209804e-02, 4.38350995e-02, 4.53550600e-02, 4.10868927e-02,
        4.04723116e-02, 4.15509372e-02, 4.08750613e-02, 4.18607008e-02},
       {3.78751280e-03, 4.06818871e-03, 4.80395377e-03, 4.98512097e-03,
        5.41314541e-03, 5.81200032e-03, 6.52291788e-03, 7.77006921e-03,
        8.03769123e-03, 9.93000190e-03, 1.15424755e-02, 1.24968349e-02,
        1.35935578e-02, 1.73580697e-02, 2.03047374e-02, 2.01007814e-02,
        1.84951278e-02, 2.70078612e-02, 8.53983518e-02, 6.52402668e-02,
        5.53137809e-02, 9.77155480e-02, 1.75292766e-02, 2.58491348e-02,
        9.06335008e-02, 1.72372818e-01, 1.41027492e+00, 1.81854774e-01,
        1.26365665e-01, 2.98893117e-02, 7.47104753e-02, 7.71200353e-02,
        2.29038390e-02, 3.46606466e-02, 3.84545748e-02, 4.90904459e-02,
        2.73417200e-02, 1.98592290e-02, 3.86526224e-02, 4.36946470e-03,
        1.66556674e-01, 8.01035646e-02, 5.92147066e-02, 2.18469037e-01,
        8.66608675e-01, 3.70983893e-01, 5.93344425e-02, 1.93626799e-01,
        2.89297516e-01, 2.41886144e-01, 4.52838416e-01, 8.31182398e-01,
        4.72488003e+00, 8.10461400e-01, 5.45170876e-01, 6.50780543e-01,
        1.09344475e+00, 2.61485137e-01, 1.95295743e-01, 3.98264861e-01,
        1.71650262e-01, 4.71731064e-01, 7.40706492e-01, 4.32750171e-01,
        1.31160988e-01, 7.44618395e-01, 1.51030263e+00, 7.56052549e-01,
        3.24023210e-01, 1.07617726e-01, 5.20511059e-01, 3.32383685e-01,
        3.35037589e-01, 2.30023107e-01, 5.32542355e-01, 2.02894127e-01,
        9.59028144e-02, 1.95646516e-01, 4.93906947e-01, 1.21314292e-01,
        4.43221703e-02, 1.70354990e-01, 1.79262639e-01, 2.09450826e-01,
        1.53923341e-01, 1.64288396e-01, 1.30822168e-01, 1.61706057e-01,
        2.06507472e-01, 4.78456628e-02, 3.80450333e-02, 3.75306943e-02,
        9.36598567e-02, 2.58850335e-02, 2.39061248e-02, 1.87616458e-01,
        2.05255412e-01, 9.96380062e-02, 1.25459526e-01, 6.50627812e-02,
        3.40821944e-01, 1.51708152e-01, 6.82737417e-02, 5.78093305e-02,
        4.49687419e-02, 5.25718588e-02, 4.54889835e-02, 4.06147740e-02,
        3.87359540e-02, 3.66218933e-02, 3.53558024e-02, 3.48005883e-02,
        3.41146075e-02, 3.37897165e-02, 3.35788453e-02, 3.25862036e-02,
        3.27079435e-02, 3.21645275e-02, 3.24073548e-02, 3.19958756e-02,
        3.18369796e-02, 3.16143232e-02, 3.12821852e-02, 3.12048732e-02,
        3.12491664e-02, 3.10857846e-02, 3.12611463e-02, 3.10272360e-02}};


void setup() {
  Serial.begin(115200);
  nn.begin(sound_model);
}

void loop() {
  for(uint8_t i =0; i<5; i++){
    Serial.print("Sample #");
    Serial.print(i + 1);
    Serial.print(": ");
    Serial.print("predicted ");
    Serial.print(nn.predictClass(X_test[i]));
    Serial.println("");
  }
  delay(2000);
}
